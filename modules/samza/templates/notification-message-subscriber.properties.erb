# Manage by Puppet

<%- if @vertical_name == 'samza_ha' -%>
# Job
job.factory.class=org.apache.samza.job.local.ProcessJobFactory
job.name=notification-messages-feed
job.id=<%= @samzaha_jobid %>

# Task
task.class=com.yapstone.samza.notifications.task.NotificationMessageSubscriberTask
task.inputs=kafka.onboarding

job.config.rewriters=regex-input-rewriter
job.config.rewriter.regex-input-rewriter.class=org.apache.samza.config.RegExTopicGenerator
job.config.rewriter.regex-input-rewriter.regex=<%= @samzaha_jobconfig %>
job.config.rewriter.regex-input-rewriter.system=kafka

# Serializers
serializers.registry.byte.class=org.apache.samza.serializers.ByteSerdeFactory
serializers.registry.string.class=org.apache.samza.serializers.StringSerdeFactory
serializers.registry.metrics.class=org.apache.samza.serializers.MetricsSnapshotSerdeFactory


# Systems
systems.kafka.samza.factory=org.apache.samza.system.kafka.KafkaSystemFactory
systems.kafka.samza.msg.serde=string
systems.kafka.streams.metrics.samza.msg.serde=metrics
systems.kafka.consumer.zookeeper.connect=<%= @samzaha_zk_server %>
systems.kafka.producer.bootstrap.servers=<%= @samzaha_bootstrap_server %>

task.checkpoint.factory=org.apache.samza.checkpoint.kafka.KafkaCheckpointManagerFactory
task.checkpoint.system=kafka
task.checkpoint.replication.factor=<%= @samzaha_task_replication %>

# failure max retries
max.retries=5

task.opts=-Dhttps.proxyHost=<%= @samzaha_proxy_server %> -Dhttps.proxyPort=<%= @samzaha_proxy_port %>

# Job Coordinator
job.coordinator.system=kafka
# Normally, this would be 3, but we have only one broker.
job.coordinator.replication.factor=<%= @samzaha_job_replication %>

# notification sender properties

<%= @samzaha_aggregatedid %>
01.notification.sender.url=<%= @samzaha_sender_url %>
01.notification.sender.connect.timeout=10
01.notification.sender.read.timeout=10
01.notification.sender.version.header.name=X-HomeAway-ExternalRequest-Version
01.notification.sender.version.header.value=1.0
01.notification.sender.username=<%= @samzaha_username %>
01.notification.sender.password=<%= @samzaha_passwd %>
01.notification.subscribed.event.types=<%= @samzaha_subscribed_event_types %>

<%- elsif @vertical_name == 'samza_rp' -%>
# Job
job.factory.class=org.apache.samza.job.local.ProcessJobFactory
job.name=notification-messages-feed
job.id=<%= @samzarp_jobid %>

# Task
task.class=com.yapstone.samza.notifications.task.NotificationMessageSubscriberTask
task.inputs=kafka.onboarding

job.config.rewriters=regex-input-rewriter
job.config.rewriter.regex-input-rewriter.class=org.apache.samza.config.RegExTopicGenerator
job.config.rewriter.regex-input-rewriter.regex=<%= @samzarp_jobconfig %>
job.config.rewriter.regex-input-rewriter.system=kafka

# Serializers
serializers.registry.byte.class=org.apache.samza.serializers.ByteSerdeFactory
serializers.registry.string.class=org.apache.samza.serializers.StringSerdeFactory
serializers.registry.metrics.class=org.apache.samza.serializers.MetricsSnapshotSerdeFactory


# Systems
systems.kafka.samza.factory=org.apache.samza.system.kafka.KafkaSystemFactory
systems.kafka.samza.msg.serde=string
systems.kafka.streams.metrics.samza.msg.serde=metrics
systems.kafka.consumer.zookeeper.connect=<%= @samzarp_zk_server %>
systems.kafka.producer.bootstrap.servers=<%= @samzarp_bootstrap_server %>

task.checkpoint.factory=org.apache.samza.checkpoint.kafka.KafkaCheckpointManagerFactory
task.checkpoint.system=kafka
task.checkpoint.replication.factor=<%= @samzarp_task_replication %>

# failure max retries
max.retries=5

task.opts=-Dhttps.proxyHost=<%= @samzarp_proxy_server %> -Dhttps.proxyPort=<%= @samzarp_proxy_port %>

# Job Coordinator
job.coordinator.system=kafka
# Normally, this would be 3, but we have only one broker.
job.coordinator.replication.factor=<%= @samzarp_job_replication %>

# notification sender properties

<%= @samzarp_aggregatedid %>
01.notification.sender.url=<%= @samzarp_sender_url %>
01.notification.sender.connect.timeout=10
01.notification.sender.read.timeout=10
01.notification.sender.version.header.name=X-HomeAway-ExternalRequest-Version
01.notification.sender.version.header.value=1.0
01.notification.sender.username=<%= @samzarp_username %>
01.notification.sender.password=<%= @samzarp_passwd %>
01.notification.subscribed.event.types=<%= samzarp_subscribed_event_types %>

<%- elsif @vertical_name == 'samza_eu' -%>
# Job
job.factory.class=org.apache.samza.job.local.ProcessJobFactory
job.name=notification-messages-feed
job.id=<%= @samzaeu_jobid %>

# Task
task.class=com.yapstone.samza.notifications.task.NotificationMessageSubscriberTask
task.inputs=kafka.onboarding

job.config.rewriters=regex-input-rewriter
job.config.rewriter.regex-input-rewriter.class=org.apache.samza.config.RegExTopicGenerator
job.config.rewriter.regex-input-rewriter.regex=<%= @samzaeu_jobconfig %>
job.config.rewriter.regex-input-rewriter.system=kafka

# Serializers
serializers.registry.byte.class=org.apache.samza.serializers.ByteSerdeFactory
serializers.registry.string.class=org.apache.samza.serializers.StringSerdeFactory
serializers.registry.metrics.class=org.apache.samza.serializers.MetricsSnapshotSerdeFactory


# Systems
systems.kafka.samza.factory=org.apache.samza.system.kafka.KafkaSystemFactory
systems.kafka.samza.msg.serde=string
systems.kafka.streams.metrics.samza.msg.serde=metrics
systems.kafka.consumer.zookeeper.connect=<%= @samzaeu_zk_server %>
systems.kafka.producer.bootstrap.servers=<%= @samzaeu_bootstrap_server %>

task.checkpoint.factory=org.apache.samza.checkpoint.kafka.KafkaCheckpointManagerFactory
task.checkpoint.system=kafka
task.checkpoint.replication.factor=<%= @samzaeu_task_replication %>

# failure max retries
max.retries=5

task.opts=-Dhttps.proxyHost=<%= @samzaeu_proxy_server %> -Dhttps.proxyPort=<%= @samzaeu_proxy_port %>

# Job Coordinator
job.coordinator.system=kafka
# Normally, this would be 3, but we have only one broker.
job.coordinator.replication.factor=<%= @samzaeu_job_replication %>

# notification sender properties

<%= @samzaeu_aggregatedid %>
01.notification.sender.url=<%= @samzaeu_sender_url %>
01.notification.sender.connect.timeout=10
01.notification.sender.read.timeout=10
01.notification.sender.version.header.name=X-HomeAway-ExternalRequest-Version
01.notification.sender.version.header.value=1.0
01.notification.sender.username=<%= @samzaeu_username %>
01.notification.sender.password=<%= @samzaeu_passwd %>
01.notification.subscribed.event.types=<%= samzaeu_subscribed_event_types %>
01.message.version=2.0
<%- end -%>
